# Redis Configuration for Production Security
# This configuration is used via Docker Compose volume mount

# Network and Security Configuration
# Bind only to all interfaces within Docker network
bind 0.0.0.0
# Enable protected mode for additional security
protected-mode yes

# Authentication - password will be passed via command line --requirepass
# This ensures the password comes from environment variables
# Note: requirepass is set via command line in docker-compose.yml

# Disable Dangerous Commands
# These commands can be used to delete all data or expose sensitive information
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG ""
rename-command SHUTDOWN SHUTDOWN_SECRET_KEY
rename-command DEBUG ""
rename-command EVAL ""

# Memory Management
# Set maximum memory limit to prevent Redis from consuming all server memory
maxmemory 256mb
# Use LRU eviction when memory limit is reached
maxmemory-policy allkeys-lru

# Persistence Configuration
# Enable AOF (Append Only File) for data durability
appendonly yes
# Sync to disk every second (good balance of performance/safety)
appendfsync everysec
# Auto rewrite AOF when it grows by 100%
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Disable RDB snapshots for cache-only usage (optional)
# Uncomment the next line if you want to disable RDB completely
# save ""

# Logging
# Log level - options: debug, verbose, notice, warning
loglevel notice

# Client Configuration
# Maximum number of connected clients
maxclients 1000
# Close idle connections after 300 seconds (5 minutes)
timeout 300

# Performance Tuning
# Disable TCP keepalive for better performance in containerized environments
tcp-keepalive 60

# Security Enhancements
# Hide Redis version in INFO output
protected-mode yes